/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"../../intl.js";import{isSome as e}from"../../core/arrayUtils.js";import{neverReached as t}from"../../core/compilerUtils.js";import{templateHasKey as n,replace as r}from"../../core/string.js";import{DomainValidationError as i}from"../../layers/support/domainUtils.js";import{isTimeOnlyField as o,NumericRangeValidationError as l,TypeValidationError as a}from"../../layers/support/fieldUtils.js";import{isAnyDateField as s}from"../../smartMapping/support/utils.js";import{getLabelForDateFieldValue as u}from"../support/dateUtils.js";import{substitute as p}from"../../intl/substitute.js";const m=e=>"field"===e?.type,d=e=>"group"===e?.type,c=e=>"relationship"===e?.type,f=e=>!d(e)&&null!=e.group,y=e=>"field"===e.type,b=e=>"group"===e.type,T=e=>"relationship"===e.type,E=e=>e.reduce(((e,t)=>d(t)?[...e,...t.inputs]:[...e,t]),[]),g=e=>E(e).filter(m),v=e=>E(e).filter(c),O=e=>null!=e&&(x(e,"combo-box")||x(e,"radio-buttons")),x=(e,t)=>null!=e&&e.input?.type===t,j=e=>null!=e&&(x(e,"text-box")||x(e,"text-area")),V=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),h=e=>"items"in e,U={typeFieldName:null,types:[]};function N(t){const{attributes:r,fieldsIndex:i,label:o,timeZone:l}=t,a=Object.keys(r).filter((e=>n(o,e))),s=a.map((e=>r[e])),u=a.map((e=>i.get(e))).filter(e);return A(o,_({values:s,fields:u,timeZone:l}))}function _(e){const{fields:t,values:n,timeZone:r}=e,i=t.map(((e,t)=>{let i=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===i));t?.name&&(i=t.name)}return(s(e)||o(e))&&(i=u(e,i,{timeZone:"date"===e.type&&null!=r?r:void 0})),[e.name,i]}));return Object.fromEntries(i)}function A(e,t){return r(r(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}const I=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:U:U,L=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};var F;!function(e){e.TOO_SHORT="length-validation-error::too-short"}(F||(F={}));const D={type:"number"},R={type:"number",intlOptions:{notation:"scientific"}},Z={day:"2-digit",month:"2-digit",year:"numeric"},w={hour:"numeric",minute:"numeric",second:"numeric"},C={...Z,...w};function S(e){return e>=1e7||e<=-1e7}const G=(e,t,n)=>{const{dataType:r,error:o,minLength:s,value:u,required:m}=e;if(!t||!o)return null;if(m&&null===u)return t.validationErrors.cannotBeNull;if(o===i.VALUE_OUT_OF_RANGE||o===l.OUT_OF_RANGE){const{field:i,range:o}=e,l={type:"date",intlOptions:{..."time-only"===i.type?w:"date-only"===i.type?Z:C,timeZone:n??void 0}};return p(t.validationErrors.outsideRange,o,{format:{max:"date"===r?l:null!=o.max&&S(o.max)?R:D,min:"date"===r?l:null!=o.min&&S(o.min)?R:D}})}return o===i.INVALID_CODED_VALUE?t.validationErrors.invalidCodedValue:o===a.INVALID_TYPE?t.validationErrors.invalidType:o===F.TOO_SHORT?p(t.validationErrors.tooShort,{min:s}):null},H=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,r=e.geometry?.type;return"polyline"===r||"polyline"===n?"line":r||n||"table"},P=e=>{const t=[];if(e.formTemplate){const{description:r,title:i}=e.formTemplate;e.fields?.forEach((e=>{const o=i&&n(i,e.name),l=r&&n(r,e.name);(o||l)&&t.push(e.name)}))}return t};function k(e){if("formTemplate"in e&&e.formTemplate){return(e.formTemplate.elements?.filter(y)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}return!1}function q(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function B(e,n){switch(n.objectType){case"any":return!0;case"null":return null==e;case"code":return e===n.codedValue?.code;case"range":return null!=e&&null!=n.minValue&&null!=n.maxValue&&+e>=n.minValue&&+e<=n.maxValue;default:return t(n.objectType),!1}}export{F as LengthValidationError,L as capabilitiesAllowEditType,g as flattenFieldInputs,E as flattenInputs,v as flattenRelationshipInputs,k as formTemplateHasInvalidFields,_ as getComputedAttributes,G as getErrorMessageForFieldInput,P as getFieldsInTitleAndDesc,H as getIconForFeature,I as getNormalizedFeatureTypeInfo,y as isFieldElement,x as isFieldElementWithInputType,O as isFieldElementWithShowNoValueOptionInput,j as isFieldElementWithTextInput,m as isFieldInput,b as isGroupElement,d as isGroupInput,f as isInputInGroupInput,V as isNumberFieldInput,T as isRelationshipElement,c as isRelationshipInput,h as isTemplateItemGroup,N as parseFormTemplateString,A as substituteFieldTemplatesInString,q as valueIsInvalidSwitchValue,B as valueIsValidContingentValue};
