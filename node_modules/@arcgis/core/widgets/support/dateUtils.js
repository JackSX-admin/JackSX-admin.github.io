/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
import"../../intl.js";import"../../core/has.js";import n from"../../core/Error.js";import{clamp as e}from"../../core/mathUtils.js";import{formatTimestamp as t,formatTimeOnly as o,formatDateOnly as l,formatDate as i}from"../../intl/date.js";import{utc as r}from"../../time/timeZoneUtils.js";import{isString as u,isNumber as a}from"./dataUtils.js";import{DateTime as s,FixedOffsetZone as m,Interval as f}from"luxon";import{getLocale as c}from"../../intl/locale.js";const d=r,y={date:null,time:null,timeZoneOffset:null},p=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),v="yyyy-MM-dd",S="TT";var h;!function(n){n.HM="HH:mm",n.HMS="HH:mm:ss",n.HMS_MS="HH:mm:ss.SSS"}(h||(h={}));const M=[h.HMS_MS,h.HMS,h.HM,S],O="latn",g=new Set(["date-only","time-only","timestamp-offset"]),w=n=>"valueAsDate"in n;function H(n){return{locale:c(),numberingSystem:O,zone:n??d}}function j(n){return n?.isValid?n.toMillis():null}function V(n,e){return null===n?null:s.fromMillis(n,H(e))}function x(n){if(null==n||!u(n)||""===n)return y;const e=s.fromISO(n,{setZone:!0});return{date:e.toFormat(v,H()),time:e.toFormat(h.HMS_MS,H()),timeZoneOffset:e.offset.toString()}}function F(n,e){if(null==n||!a(n)||isNaN(n))return y;const t=V(n,e);return t?{date:t.toFormat(v,H(e)),time:t.toFormat(S,H(e))}:y}function I(n,e,r){if(!n||null==e)return null;switch(console.log("getLabelForDateFieldValue"),console.log(" -- value: ",e),console.log(" -- options: ",r),n.type){case"date":return i(e,r);case"date-only":return l(e,r);case"time-only":return o(e,r);case"timestamp-offset":return t(e,r);default:return null}}function Z(n){const{dateComponent:e,timeComponent:t,timeZoneComponent:o,oldValue:l}=n;if(!e?.value||!t?.value)return null;const{year:i,month:u,day:a}=s.fromFormat(e.value,v),{hour:f,minute:c,second:d,millisecond:y}=T(t,r)??s.now(),p=x(l),S=null!=o?.value?parseInt(o.value,10):null!=p.timeZoneOffset?parseInt(p.timeZoneOffset,10):(new Date).getTimezoneOffset(),h=m.instance(S),M=s.fromObject({year:i,month:u,day:a,hour:f,minute:c,second:d,millisecond:y},{zone:h});return M.isValid?M.toISO({includeOffset:!0}):null}function D(n){const{dateComponent:e,timeComponent:t,timeZone:o,max:l,min:i,oldValue:r}=n,u=T(e,o);let a=!!n.applyRange;if(!u)return null;let m=null;if(null!=t?.value){const n=T(t,o),e=Date.now(),i=null!=l&&l<e?l:e,r=s.fromMillis(i,H(o)),a=u||r,{year:f,month:c,day:d}=a,{hour:y,minute:p,second:v,millisecond:S}=n||r;m=a.set({year:f,month:c,day:d,hour:y,minute:p,second:v,millisecond:S})}else{const n=V(C({value:r??Date.now(),max:l,min:i}),o),{year:e,month:t,day:s}=u,{hour:f,minute:c,second:d,millisecond:y}=n;a=!0,m=u.set({year:e,month:t,day:s,hour:f,minute:c,second:d,millisecond:y})}if(!m.isValid)return null;const f=m.toMillis();return a?C({value:f,max:l,min:i}):f}function T(n,e){if(!n||null==n.value||Array.isArray(n.value))return null;let t=null;return t=w(n)?s.fromFormat(n.value,v,H(e)):_(n.value),t?.isValid?t:null}function b(n){const{max:e,min:t,value:o}=n;return!isNaN(o)&&(!(null!=e&&o>e)&&!(null!=t&&o<t))}function C(n){const{max:t,min:o,value:l}=n;return null!=t&&null!=o?e(l,o,t):null!=t&&l>t?t:null!=o&&l<o?o:l}function A(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new n("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const o=t.split(":"),l=new Array(3);for(let n=0;n<3;n++){const e=o.at(n)??"";l[n]=e.padStart(2,"0")}return l.join(":")}function N(n,e){switch(e){case"date":return n.getTime();case"date-only":return n.toISODate();case"time-only":return A(n.toISOTime(!0,!1));case"timestamp-offset":return n.toISOString(!1);default:return null}}function z(n){return!!n&&"object"==typeof n&&"getTime"in n&&"toISOString"in n&&"timeZone"in n}function U(n){return s.fromFormat(n,v)}function _(n){let e=null;return M.find((t=>(e=s.fromFormat(n,t),e.isValid))),e}function k(n){return s.fromISO(n)}function E(n){const{type:e,range:t,value:o}=n;if(null==o||!t)return!0;if("date"===e)return b({value:o,min:t.min,max:t.max});const{rawMax:l,rawMin:i}=t;if(!u(l)||!u(i)||!u(o))return!0;let r=null,a=null,s=null;switch(e){case"date-only":r=U(l),a=U(i),s=U(o);break;case"time-only":r=_(l),a=_(i),s=_(o);break;case"timestamp-offset":r=k(l),a=k(i),s=k(o)}return!(r?.isValid&&a?.isValid&&s?.isValid)||(f.fromDateTimes(a,r).contains(s)||a.valueOf()===s.valueOf()||r.valueOf()===s.valueOf())}export{h as TimeStampOffsetPattern,N as arcadeDateToFieldValue,C as clampValueToRange,V as createDateTimeFromFieldValue,g as dateFieldsWithStringFieldValue,U as dateOnlyToDateTime,E as dateTimeIsInRange,j as dateTimeToFieldValue,v as defaultDatePattern,S as defaultTimePattern,H as getDefaultLocaleOptions,Z as getISOFieldValueFromDateComponents,I as getLabelForDateFieldValue,T as getLocalDateTimeFromComponent,D as getUnixFieldValueFromDateComponents,z as isArcadeDate,w as isCalciteDateComponent,A as normalizeTimeOnlyString,O as numberingSystem,x as prepareISOFieldValueForDateComponents,F as prepareUnixFieldValueForDateComponents,M as supportedTimeFormats,_ as timeOnlyToDateTime,p as timeResolutionToStepMap,k as timestampOffsetToDateTime,b as valueIsInRange};
